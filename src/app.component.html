<main class="min-h-screen bg-gray-900 flex flex-col items-center justify-center p-4 relative">
  <div class="absolute top-4 end-4 z-20">
    <app-language-switcher></app-language-switcher>
  </div>
  
  <div class="w-full max-w-2xl bg-gray-800 rounded-2xl shadow-2xl p-6 md:p-8 transform transition-all duration-300">
    
    <!-- Header -->
    <div class="text-center mb-6">
      <h1 class="text-4xl md:text-5xl font-bold text-white tracking-tight">
        <span class="text-sky-400">{{ 'TITLE_ACCENT' | translate }}</span> {{ 'TITLE' | translate }}
      </h1>
      <p class="text-gray-400 mt-2">{{ 'SUBTITLE' | translate }}</p>
    </div>

    <!-- Loading and Error States -->
    @if (loading()) {
      <div class="my-16">
        <app-spinner></app-spinner>
        <p class="text-center text-gray-400 mt-4">{{ 'LOADING_TEXT' | translate }}</p>
      </div>
    } @else if (error()) {
      <div class="bg-red-900/50 border border-red-700 text-red-300 px-4 py-3 rounded-lg text-center" role="alert">
        <strong class="font-bold">{{ 'ERROR_HEADING' | translate }}</strong>
        <span class="block sm:inline">{{ error() }}</span>
      </div>
    } @else {
      <!-- Main Converter UI -->
      <div class="flex flex-row items-stretch gap-x-3">
        
        <!-- Swap Button (Mobile) -->
        <div class="md:hidden flex-shrink-0 flex items-center">
          <button (click)="swapCurrencies()" class="p-3 bg-gray-700 rounded-full hover:bg-sky-500 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-sky-400 focus:ring-offset-2 focus:ring-offset-gray-800">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4" />
            </svg>
          </button>
        </div>

        <!-- Conversion Panels -->
        <div class="flex-grow flex flex-col md:flex-row md:items-center justify-between gap-4">
          
          <!-- From Amount -->
          <div class="w-full">
            <label for="fromAmount" class="block text-sm font-medium text-gray-400 mb-1.5">{{ 'AMOUNT' | translate }}</label>
            <div class="relative">
              <div class="flex">
                <!-- Custom Currency Dropdown Button -->
                <button 
                  type="button" 
                  (click)="toggleFromDropdown()"
                  class="z-10 flex items-center justify-between w-28 flex-shrink-0 cursor-pointer appearance-none rounded-s-lg border border-gray-600 bg-gray-700 px-3 py-2.5 text-sm font-medium text-white hover:bg-gray-600 focus:border-sky-500 focus:outline-none focus:ring-1 focus:ring-sky-500"
                  aria-haspopup="true" [attr.aria-expanded]="fromDropdownOpen()">
                  @if (fromCurrencyData(); as currency) {
                    <div class="flex items-center truncate">
                      @if (currency.flagCode) {
                        <img [src]="'https://flagcdn.com/w20/' + currency.flagCode + '.png'" [alt]="currency.code" class="w-5 h-auto me-2 object-contain rounded-sm"/>
                      } @else {
                        <div class="w-5 h-5 me-2 flex-shrink-0 flex items-center justify-center bg-gray-600 rounded-sm text-xs">?</div>
                      }
                      <span class="truncate">{{ currency.code }}</span>
                    </div>
                  }
                  <svg class="w-4 h-4 ms-2 -me-1 text-gray-400 flex-shrink-0" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
                  </svg>
                </button>
                <input 
                  type="text"
                  inputmode="decimal"
                  id="fromAmount"
                  class="relative z-0 block w-full min-w-0 flex-1 rounded-e-lg border border-gray-600 bg-gray-900 px-3 py-2.5 text-white placeholder-gray-500 focus:border-sky-500 focus:outline-none focus:ring-1 focus:ring-sky-500 text-right"
                  [value]="formattedFromAmount()"
                  (input)="onFromAmountChange($event)"
                  placeholder="1.00">
              </div>

              <!-- Dropdown Menu -->
              @if (fromDropdownOpen()) {
                <div class="origin-top-start absolute start-0 mt-2 w-72 rounded-md shadow-lg bg-gray-700 ring-1 ring-black ring-opacity-5 focus:outline-none z-50 max-h-48 md:max-h-60 overflow-y-auto">
                  <div class="py-1" role="menu" aria-orientation="vertical">
                    @for(currency of currencies(); track currency.code) {
                      <a 
                        href="#"
                        class="flex items-center px-4 py-1 text-sm text-gray-200 hover:bg-gray-600 hover:text-white"
                        [class.bg-sky-600]="currency.code === fromCurrency()"
                        role="menuitem"
                        (click)="selectFromCurrency(currency.code, $event)">
                        @if (currency.flagCode) {
                          <img [src]="'https://flagcdn.com/w40/' + currency.flagCode + '.png'" [alt]="currency.code" class="w-6 h-auto me-3 object-contain"/>
                        } @else {
                          <div class="w-6 h-5 me-3 flex-shrink-0 flex items-center justify-center bg-gray-600 text-xs">?</div>
                        }
                        <span class="font-medium">{{ currency.code }}</span>
                        <span class="text-gray-400 ms-2 truncate">{{ currency.name }}</span>
                      </a>
                    }
                  </div>
                </div>
              }
            </div>
            <p class="text-xs text-gray-400 mt-1.5 h-4 px-1 truncate">{{ fromCurrencyFullName() }}</p>
          </div>

          <!-- Swap Button (Desktop) -->
          <div class="hidden md:flex flex-shrink-0 mt-2 md:mt-6">
            <button (click)="swapCurrencies()" class="p-3 bg-gray-700 rounded-full hover:bg-sky-500 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-sky-400 focus:ring-offset-2 focus:ring-offset-gray-800">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4" />
              </svg>
            </button>
          </div>

          <!-- To Amount (Result) -->
          <div class="w-full">
            <label for="toAmount" class="block text-sm font-medium text-gray-400 mb-1.5">{{ 'CONVERTED_AMOUNT' | translate }}</label>
            <div class="relative">
              <div class="flex">
                <!-- Custom Currency Dropdown Button -->
                <button 
                  type="button" 
                  (click)="toggleToDropdown()"
                  class="z-10 flex items-center justify-between w-28 flex-shrink-0 cursor-pointer appearance-none rounded-s-lg border border-gray-600 bg-gray-700 px-3 py-2.5 text-sm font-medium text-white hover:bg-gray-600 focus:border-sky-500 focus:outline-none focus:ring-1 focus:ring-sky-500"
                  aria-haspopup="true" [attr.aria-expanded]="toDropdownOpen()">
                  @if (toCurrencyData(); as currency) {
                    <div class="flex items-center truncate">
                      @if (currency.flagCode) {
                        <img [src]="'https://flagcdn.com/w20/' + currency.flagCode + '.png'" [alt]="currency.code" class="w-5 h-auto me-2 object-contain rounded-sm"/>
                      } @else {
                        <div class="w-5 h-5 me-2 flex-shrink-0 flex items-center justify-center bg-gray-600 rounded-sm text-xs">?</div>
                      }
                      <span class="truncate">{{ currency.code }}</span>
                    </div>
                  }
                  <svg class="w-4 h-4 ms-2 -me-1 text-gray-400 flex-shrink-0" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
                  </svg>
                </button>
                <input 
                  type="text"
                  inputmode="decimal"
                  id="toAmount"
                  class="relative z-0 block w-full min-w-0 flex-1 rounded-e-lg border border-gray-600 bg-gray-900 px-3 py-2.5 text-white placeholder-gray-500 focus:border-sky-500 focus:outline-none focus:ring-1 focus:ring-sky-500 text-right"
                  [value]="formattedToAmount()"
                  (input)="onToAmountChange($event)">
              </div>
               <!-- Dropdown Menu -->
              @if (toDropdownOpen()) {
                <div class="origin-top-start absolute start-0 mt-2 w-72 rounded-md shadow-lg bg-gray-700 ring-1 ring-black ring-opacity-5 focus:outline-none z-50 max-h-48 md:max-h-60 overflow-y-auto">
                  <div class="py-1" role="menu" aria-orientation="vertical">
                    @for(currency of currencies(); track currency.code) {
                      <a 
                        href="#"
                        class="flex items-center px-4 py-1 text-sm text-gray-200 hover:bg-gray-600 hover:text-white"
                        [class.bg-sky-600]="currency.code === toCurrency()"
                        role="menuitem"
                        (click)="selectToCurrency(currency.code, $event)">
                        @if (currency.flagCode) {
                          <img [src]="'https://flagcdn.com/w40/' + currency.flagCode + '.png'" [alt]="currency.code" class="w-6 h-auto me-3 object-contain"/>
                        } @else {
                          <div class="w-6 h-5 me-3 flex-shrink-0 flex items-center justify-center bg-gray-600 text-xs">?</div>
                        }
                        <span class="font-medium">{{ currency.code }}</span>
                        <span class="text-gray-400 ms-2 truncate">{{ currency.name }}</span>
                      </a>
                    }
                  </div>
                </div>
              }
            </div>
            <p class="text-xs text-gray-400 mt-1.5 h-4 px-1 truncate">{{ toCurrencyFullName() }}</p>
          </div>
        </div>
      </div>

      <!-- Footer Info -->
      <div class="text-center text-gray-500 text-xs mt-8">
        <p>
          {{ 'RATE_PREFIX' | translate }} {{ fromCurrency() }} {{ 'RATE_EQUALS' | translate }}
          {{ singleUnitRate() | number:'1.4-6':languageService.currentLocaleId() }} 
          {{ toCurrency() }}
        </p>
        <p class="mt-1">{{ 'LAST_UPDATED' | translate }} {{ lastUpdated() | date:'medium':'':languageService.currentLocaleId() }}</p>
      </div>
    }
  </div>
</main>